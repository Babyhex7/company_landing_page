---
// Testimonials Section Component
import { getTestimonials, getStrapiMediaUrl } from '../../lib/strapi';

const testimonials = await getTestimonials();

// Default testimonials if Strapi is not available
const defaultTestimonials = [
  {
    name: 'Sarah Johnson',
    role: 'CEO',
    company: 'TechStart Inc.',
    content: 'Working with NexaTech was an absolute pleasure. They delivered our platform ahead of schedule and exceeded all our expectations. The attention to detail and modern design approach really set them apart.',
    avatar: { url: null },
    rating: 5
  },
  {
    name: 'Michael Chen',
    role: 'Product Manager',
    company: 'InnovateLab',
    content: 'The team understood our vision perfectly and transformed it into a beautiful, functional application. Their expertise in modern web technologies is impressive.',
    avatar: { url: null },
    rating: 5
  },
  {
    name: 'Emily Rodriguez',
    role: 'Founder',
    company: 'GreenTech Solutions',
    content: 'From initial concept to final delivery, the process was seamless. They provided valuable insights that improved our product significantly. Highly recommended!',
    avatar: { url: null },
    rating: 5
  },
  {
    name: 'David Kim',
    role: 'CTO',
    company: 'DataFlow Systems',
    content: 'Exceptional technical skills combined with great communication. They built our analytics dashboard exactly as we envisioned, with amazing performance.',
    avatar: { url: null },
    rating: 5
  }
];

const displayTestimonials = testimonials?.length ? testimonials : defaultTestimonials;
---

<section id="testimonials" class="section relative overflow-hidden">
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-30">
    <div class="absolute top-1/4 left-0 w-96 h-96 bg-indigo-500/20 rounded-full filter blur-3xl"></div>
    <div class="absolute bottom-1/4 right-0 w-96 h-96 bg-purple-500/20 rounded-full filter blur-3xl"></div>
  </div>

  <div class="container mx-auto px-6 relative z-10">
    <!-- Section Header -->
    <div class="text-center max-w-3xl mx-auto mb-16">
      <span class="animate-fade-up inline-block text-indigo-400 font-semibold mb-4">Testimonials</span>
      <h2 class="animate-fade-up delay-100 text-heading font-bold text-white mb-6">
        What Our <span class="gradient-text">Clients Say</span>
      </h2>
      <p class="animate-fade-up delay-200 text-lg text-slate-400">
        Don't just take our word for it. Here's what our clients have to say about working with us.
      </p>
    </div>

    <!-- Testimonials Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-5xl mx-auto">
      {displayTestimonials.map((testimonial: any, index: number) => (
        <div class={`animate-fade-up delay-${(index % 2 + 1) * 100} glass-card p-8`}>
          <!-- Quote Icon -->
          <div class="text-indigo-500/30 mb-6">
            <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
            </svg>
          </div>

          <!-- Content -->
          <p class="text-slate-300 text-lg leading-relaxed mb-8">
            "{testimonial.content}"
          </p>

          <!-- Author -->
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 rounded-2xl overflow-hidden bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center">
              {testimonial.avatar?.url ? (
                <img 
                  src={getStrapiMediaUrl(testimonial.avatar.url)}
                  alt={testimonial.name}
                  class="w-full h-full object-cover"
                />
              ) : (
                <span class="text-white text-xl font-bold">
                  {testimonial.name.charAt(0)}
                </span>
              )}
            </div>
            <div>
              <h4 class="text-white font-semibold">{testimonial.name}</h4>
              <p class="text-slate-400 text-sm">
                {testimonial.role} at {testimonial.company}
              </p>
            </div>
            <!-- Stars -->
            <div class="ml-auto flex gap-1">
              {[...Array(5)].map((_, i) => (
                <svg 
                  class={`w-5 h-5 ${i < (testimonial.rating || 5) ? 'text-yellow-400' : 'text-slate-600'}`}
                  fill="currentColor" 
                  viewBox="0 0 20 20"
                >
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              ))}
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
